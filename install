#!/usr/bin/env python3
#--*-- coding: utf-8 --*--


"""
install script for ethOS-update-manager
chmod exec for launch.py and main.py
create aliases and cmd for autoclaunch in .bashrc with fancy text
try to reboot 
"""

# import 

import os, time


# functions

def write_bashrc(txt=" ") : 

	cmd = """echo "{}" >> /home/ethos/.bashrc """.format(txt)
	os.system(cmd)


def counter(k=4) : 

	time.sleep(1)
	print("")
	for i in range(k, 0, -1) : 
		print(str(i-1), end=" --> ")
		time.sleep(1)


# main

def main() : 

	# prepare sys
	os.system("cd /home/ethos/")
	os.system("chmod +x /home/ethos/ethOS-update-manager/launch.py")
	os.system("chmod +x /home/ethos/ethOS-update-manager/src/main.py")


	# title in .bashrc
	write_bashrc() #  empty line
	write_bashrc()
	write_bashrc("###################################")
	write_bashrc("#      ethOS-update-manager        ")
	write_bashrc("###################################")
	write_bashrc()
	write_bashrc()

	# create alias (shortcup for CLI) 'LAUNCH' to launch program manualy :
	write_bashrc("# create alias (shortcup for CLI) LAUNCH to launch program manualy :")
	write_bashrc("alias LAUNCH='python3 /home/ethos/ethOS-update-manager/launch.py'")

	write_bashrc()

	# for automatic program launch (background) at each ethos stratup :
	write_bashrc("# for automatic program launch (background) at each ethos stratup:")
	write_bashrc("python3 /home/ethos/ethOS-update-manager/launch.py")

	write_bashrc()
	write_bashrc()


	# info reboot
	print(	"\n\n"
			"######################################################\n"
			"######################################################\n\n\n"
			"-->  your program is now installed and functional <--\n\n\n"
			"-->   for full install, system will reboot in 3s  <--\n\n\n"
			"######################################################\n"
			"######################################################\n"
			"\n\n")

	counter(4)


	#auto reboot 
	ans = os.system("r")
	if ans : 
		ans = os.system("reboot")
		if ans : 
			ans = os.system("sudo reboot")
			if ans : 
				print(	"\n\n"
						"##################################################\n"
						"##################################################\n\n\n"
						"-->  auto reboot fail : please reboot manualy  <--\n\n\n"
						"##################################################\n"
						"##################################################\n"
						"\n\n")


if __name__ == '__main__':
	main()

